!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/hmppsAssets",t(t.s=0)}([function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}n(1),n(2),n(3),n(4),n(5),n(6);var r=n(7),i=o(r),a=n(8),s=o(a),c=n(9),u=o(c),l=window.HMPPS||{ereader:s.default,games:u.default};l.addCookieMessage=function(){var e=document.getElementById("global-cookie-message");e&&null===(0,i.default)("seen_cookie_message")&&(e.style.display="block",(0,i.default)("seen_cookie_message","yes",{days:28}))},document.addEventListener("DOMContentLoaded",function(){l.addCookieMessage(),Object.keys(l).forEach(function(e){"function"==typeof l[e].init&&l[e].init()})}),window.HMPPS=l},function(e,t,n){"use strict";!function(){function e(e,t,n){e.addEventListener?e.addEventListener(t,function(e){n(e,e.target)},!1):e.attachEvent&&e.attachEvent("on"+t,function(e){n(e,e.srcElement)})}function t(e){return"number"==typeof e.which?e.which:e.keyCode}function n(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function o(o,r){e(o,"keypress",function(e,o){t(e)!==s&&t(e)!==c||"summary"===o.nodeName.toLowerCase()&&(n(e),o.click?o.click():r(e,o))}),e(o,"keyup",function(e,o){t(e)===c&&"SUMMARY"===o.nodeName&&n(e)}),e(o,"click",function(e,t){r(e,t)})}function r(e,t){do{if(!e||e.nodeName.toLowerCase()===t)break;e=e.parentNode}while(e);return e}function i(e){function t(e){var t="true"===e.__details.__summary.getAttribute("aria-expanded"),n="true"===e.__details.__content.getAttribute("aria-hidden");if(e.__details.__summary.setAttribute("aria-expanded",t?"false":"true"),e.__details.__content.setAttribute("aria-hidden",n?"false":"true"),!a){e.__details.__content.style.display=t?"none":"";null!==e.__details.getAttribute("open")?e.__details.removeAttribute("open"):e.__details.setAttribute("open","open")}return e.__twisty&&(e.__twisty.firstChild.nodeValue=t?"►":"▼",e.__twisty.setAttribute("class",t?"arrow arrow-closed":"arrow arrow-open")),!0}if(!u&&(u=!0,0!==(e=document.getElementsByTagName("details")).length)){var n=e.length,i=0;for(i;i<n;i++){var s=e[i];if(s.__summary=s.getElementsByTagName("summary").item(0),s.__content=s.getElementsByTagName("div").item(0),!s.__summary||!s.__content)return;s.__content.id||(s.__content.id="details-content-"+i),s.setAttribute("role","group"),s.__summary.setAttribute("role","button"),s.__summary.setAttribute("aria-controls",s.__content.id),a||(s.__summary.tabIndex=0);var c=null!==s.getAttribute("open");if(!0===c?(s.__summary.setAttribute("aria-expanded","true"),s.__content.setAttribute("aria-hidden","false")):(s.__summary.setAttribute("aria-expanded","false"),s.__content.setAttribute("aria-hidden","true"),a||(s.__content.style.display="none")),s.__summary.__details=s,!a){var l=document.createElement("i");!0===c?(l.className="arrow arrow-open",l.appendChild(document.createTextNode("▼"))):(l.className="arrow arrow-closed",l.appendChild(document.createTextNode("►"))),s.__summary.__twisty=s.__summary.insertBefore(l,s.__summary.firstChild),s.__summary.__twisty.setAttribute("aria-hidden","true")}}o(document,function(e,n){return!(n=r(n,"summary"))||t(n)})}}var a="boolean"==typeof document.createElement("details").open,s=13,c=32,u=!1;e(document,"DOMContentLoaded",i),e(window,"load",i)}()},function(e,t,n){"use strict";Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,o=function(){},r=function(){return n.apply(this instanceof o&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return o.prototype=this.prototype,r.prototype=new o,r})},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=e+"="+t+"; path=/";if(n.days){var r=new Date;r.setTime(24*(r.getTime()+n.days)*60*60*1e3),o+="; expires="+r.toGMTString()}"https:"===document.location.protocol&&(o+="; Secure"),document.cookie=o},r=function(e){for(var t=e+"=",n=document.cookie.split(";"),o=0,r=n.length;o<r;o++){for(var i=n[o];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return decodeURIComponent(i.substring(t.length))}return null},i=function(e,t,n){return void 0!==t?!1===t||null===t?o(e,"",{days:-1}):o(e,t,n):r(e)};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return{init:function(){var e=document.querySelectorAll(".js-ereader-trigger");Array.prototype.forEach.call(e,function(e,t){e.addEventListener("click",function(e){e.preventDefault();var t=e.target.parentNode.getAttribute("data-src"),n=["height="+(screen.height-100),"width="+screen.width,"fullscreen=yes","scrollbars=yes"].join(",");console.log(n);e.target.parentNode.getAttribute("href");if(t.indexOf(".pdf")>=0){window.open(t,"_blank",n)}else{console.log(t);var o=window.open(t,"_blank",n);HMPPS.ereader.createEpub(t,o)}})})},createEpub:function(e,t){HMPPS.ereader.createMarkup(t);var n=t.document.body;n.classList.add("epub");var o=n.querySelector(".js-ereader-next"),r=n.querySelector(".js-ereader-prev"),i=n.querySelector(".js-ereader-area"),a=new EPUBJS.Book({width:t.innerWidth/2,height:t.innerHeight,orientation:"auto",spreads:"false",restore:"true",bookPath:e});console.log(a),a.generatePagination(50,100),a.open(e),a.renderTo(i).then(function(){var e=a.getCurrentLocationCfi(),t=a.pagination.pageFromCfi(e);t.value=t,console.log(t.value),console.log(t)}),r.addEventListener("click",function(){a.prevPage()}),o.addEventListener("click",function(){a.nextPage()});var s=function(e){37==(e.keyCode||e.which)&&a.prevPage(),39==(e.keyCode||e.which)&&a.nextPage()};a.on("keyup",s)},createMarkup:function(e){var t=document.createElement("div");t.innerHTML='<div class="ereader__area js-ereader-area"></div>\n        <div class="ereader__buttons">\n          <button class="js-ereader-prev ereader__prev" type="button" name="button">Prev</button>\n          <button class="js-ereader-next ereader__next" type="button" name="button">Next</button>\n        </div>',t.classList.add("ereader"),e.document.write('<html><head><title>Book</title><link href="/hmppsAssets/css/hmpps.css"  rel="stylesheet" type="text/css"></head><body></body></html>'),e.document.body.appendChild(t)}}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=function(){return{init:function(){var e=this,t=document.querySelector(".js-chess");document.querySelector(".js-newgame");if(!t)return!1;var n=HMPPS.games.engineGame(),o=function(){var e=60*parseFloat($("#timeBase").val()),t=parseFloat($("#timeInc").val()),o=parseInt($("#skillLevel").val());n.reset(),n.setTime(e,t),n.setSkillLevel(o),n.setPlayerColor(($("#color-white").hasClass("active"),"white")),n.setDisplayScore($("#showScore").is(":checked")),n.start()};n.setSkillLevel,document.querySelector("#skillLevel").addEventListener("change",function(t){n.setSkillLevel(parseInt(e.value,10))}),document.querySelector(".js-newgame").addEventListener("click",function(e){o()}),o()},engineGame:function(e){function t(e,t){(t||p).postMessage(e)}function n(){var e="Engine: ";v.engineLoaded?v.engineReady?e+="ready.":e+="loaded...":e+="loading...",v.search&&(e+="<br>"+v.search,v.score&&y&&(e+=("Mate"===v.score.substr(0,4)?" ":" Score: ")+v.score)),$("#engineStatus").html(e)}function r(e,t){var n=!1;b.startTime>0&&e==b.clockColor&&(t=Math.max(0,t+b.startTime-Date.now()),n=!0);var o=e==_?"#time2":"#time1",r=Math.ceil(t/1e3),i=Math.floor(r/60);r-=60*i;var a=Math.floor(i/60);i-=60*a;var s=a+":"+("0"+i).slice(-2)+":"+("0"+r).slice(-2);n&&(s+=1&r?" <--":" <-"),$(o).text(s)}function i(){r("white",b.wtime),r("black",b.btime)}function a(){i();var e=("white"==b.clockColor?b.wtime:b.btime)+b.startTime-Date.now(),t=e%1e3+1;g=setTimeout(a,t)}function s(){if(null!==g&&(clearTimeout(g),g=null),b.startTime>0){var e=Date.now()-b.startTime;b.startTime=null,"white"==b.clockColor?b.wtime=Math.max(0,b.wtime-e):b.btime=Math.max(0,b.btime-e)}}function c(){"w"==f.turn()?(b.wtime+=b.winc,b.clockColor="white"):(b.btime+=b.binc,b.clockColor="black"),b.startTime=Date.now(),a()}function u(){for(var e="",t=f.history({verbose:!0}),n=0;n<t.length;++n){var o=t[n];e+=" "+o.from+o.to+(o.promotion?o.promotion:"")}return e}function l(){s(),$("#pgn").text(f.pgn()),d.position(f.fen()),i();var e="w"==f.turn()?"white":"black";f.game_over()||(e!=_&&(t("position startpos moves"+u()),t("position startpos moves"+u(),h),k.textContent="",t("eval",h),t(b&&b.wtime?"go "+(b.depth?"depth "+b.depth:"")+" wtime "+b.wtime+" winc "+b.winc+" btime "+b.btime+" binc "+b.binc:"go "+(b.depth?"depth "+b.depth:"")),w=!0),f.history().length>=2&&!b.depth&&!b.nodes&&c())}e=e||{};var d,m,f=new Chess,p="function"==typeof STOCKFISH?STOCKFISH():new Worker(e.stockfishjs||"stockfish.js"),h="function"==typeof STOCKFISH?STOCKFISH():new Worker(e.stockfishjs||"stockfish.js"),v={},y=!1,b={wtime:3e5,btime:3e5,winc:2e3,binc:2e3},_="white",g=null,w=!1,k=document.getElementById("evaluation"),S=function(e,t,n,o){var r="white"==_?/^b/:/^w/;if(f.game_over()||-1!==t.search(r))return!1};setInterval(function(){m||f.game_over()&&(m=!0,alert("Game Over"))},1e3),t("uci"),h.onmessage=function(e){var t;"uciok"!==(t=e&&"object"===(void 0===e?"undefined":o(e))?e.data:e)&&"readyok"!==t&&"option name"!==t.substr(0,11)&&(k.textContent&&(k.textContent+="\n"),k.textContent+=t)},p.onmessage=function(e){var r;if("uciok"==(r=e&&"object"===(void 0===e?"undefined":o(e))?e.data:e))v.engineLoaded=!0;else if("readyok"==r)v.engineReady=!0;else{var i=r.match(/^bestmove ([a-h][1-8])([a-h][1-8])([qrbn])?/);if(i?(w=!1,f.move({from:i[1],to:i[2],promotion:i[3]}),l(),t("eval",h),k.textContent=""):(i=r.match(/^info .*\bdepth (\d+) .*\bnps (\d+)/))&&(v.search="Depth: "+i[1]+" Nps: "+i[2]),i=r.match(/^info .*\bscore (\w+) (-?\d+)/)){var a=parseInt(i[2])*("w"==f.turn()?1:-1);"cp"==i[1]?v.score=(a/100).toFixed(2):"mate"==i[1]&&(v.score="Mate in "+Math.abs(a)),(i=r.match(/\b(upper|lower)bound\b/))&&(v.score=("upper"==i[1]==("w"==f.turn())?"<= ":">= ")+v.score)}}n()};var C=function(e,t){if(null===f.move({from:e,to:t,promotion:document.getElementById("promote").value}))return"snapback";l()},x=function(){d.position(f.fen())},M={showErrors:!0,draggable:!0,position:"start",onDragStart:S,onDrop:C,onSnapEnd:x,pieceTheme:"/hmppsAssets/img/chesspieces/wikipedia/{piece}.png"};return d=new ChessBoard("js-board",M),{reset:function(){f.reset(),t("setoption name Contempt value 0"),this.setSkillLevel(0),t("setoption name King Safety value 0")},loadPgn:function(e){f.load_pgn(e)},setPlayerColor:function(e){_=e,d.orientation(_)},setSkillLevel:function(e){var n,o;e<0&&(e=0),e>20&&(e=20),b.level=e,b.depth=e<5?"1":e<10?"2":e<15?"3":"",t("setoption name Skill Level value "+e),o=Math.round(6.35*e+1),n=Math.round(-.5*e+10),t("setoption name Skill Level Maximum Error value "+n),t("setoption name Skill Level Probability value "+o)},setTime:function(e,t){b={wtime:1e3*e,btime:1e3*e,winc:1e3*t,binc:1e3*t}},setDepth:function(e){b={depth:e}},setNodes:function(e){b={nodes:e}},setContempt:function(e){t("setoption name Contempt value "+e)},setAggressiveness:function(e){t("setoption name Aggressiveness value "+e)},setDisplayScore:function(e){y=e,n()},start:function(){t("ucinewgame"),t("isready"),v.engineReady=!1,v.search=null,n(),l(),m=!1},undo:function(){return!w&&(f.undo(),f.undo(),v.search=null,n(),l(),!0)}}}}}()}]);